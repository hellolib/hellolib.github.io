(window.webpackJsonp=window.webpackJsonp||[]).push([[158],{480:function(a,s,t){"use strict";t.r(s);var n=t(3),r=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"flask-migrate使用教程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#flask-migrate使用教程"}},[a._v("#")]),a._v(" Flask-Migrate使用教程")]),a._v(" "),s("ul",[s("li",[s("p",[a._v("功能:flask—migrate是flask的一个扩展模块，主要是扩展数据库表结构的。")])]),a._v(" "),s("li",[s("p",[a._v("项目准备:一个干净的Flask项目,下载连接地址:  https://pan.baidu.com/s/1WqdINYFPt3r-CEqOOC3Gog")])])]),a._v(" "),s("h2",{attrs:{id:"_1-安装flask-migrate"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装flask-migrate"}},[a._v("#")]),a._v(" 1.安装Flask-Migrate")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("pip install Flask-Migrate\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"_2-将-flask-migrate-加入到-flask-项目中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-将-flask-migrate-加入到-flask-项目中"}},[a._v("#")]),a._v(" 2.将 Flask-Migrate 加入到 Flask 项目中")]),a._v(" "),s("ul",[s("li",[s("strong",[a._v("注意了 Flask-Migrate 是要依赖 Flask-Script 组件的")])])]),a._v(" "),s("div",{staticClass:"language-python line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# MyApp/manager.py")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" MyApp\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 导入 Flask-Script 中的 Manager")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" flask_script "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" Manager\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 导入 Flask-Migrate 中的 Migrate 和 MigrateCommand")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 这两个东西说白了就是想在 Flask-Script 中添加几个命令和指令而已")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" flask_migrate "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" Migrate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("MigrateCommand\n\napp "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" MyApp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("create_app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 让app支持 Manager")]),a._v("\nmanager "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" Manager"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# type:Manager")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Migrate 既然是数据库迁移,那么就得告诉他数据库在哪里")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 并且告诉他要支持那个app")]),a._v("\nMigrate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("MyApp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("db"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 现在就要告诉manager 有新的指令了,这个新指令在MigrateCommand 中存着呢")]),a._v("\nmanager"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("add_command"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"db"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("MigrateCommand"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 当你的命令中出现 db 指令,则去MigrateCommand中寻找对应关系")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[a._v('"""\n数据库迁移指令:\npython manager.py db init \npython manager.py db migrate   # Django中的 makemigration\npython manager.py db upgrade  # Django中的 migrate\n"""')]),a._v("\n\n\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[a._v("@manager"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("command")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("DragonFire")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("arg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("arg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[a._v("@manager"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("option")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"--name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("dest"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"name"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[a._v("@manager"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("option")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-s"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"--say"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("dest"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"say"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("def")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("talk")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("say"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[a._v('f"')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("你可真")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("say"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" __name__ "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'__main__'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#app.run()")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 替换原有的app.run(),然后大功告成了")]),a._v("\n    manager"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br"),s("span",{staticClass:"line-number"},[a._v("14")]),s("br"),s("span",{staticClass:"line-number"},[a._v("15")]),s("br"),s("span",{staticClass:"line-number"},[a._v("16")]),s("br"),s("span",{staticClass:"line-number"},[a._v("17")]),s("br"),s("span",{staticClass:"line-number"},[a._v("18")]),s("br"),s("span",{staticClass:"line-number"},[a._v("19")]),s("br"),s("span",{staticClass:"line-number"},[a._v("20")]),s("br"),s("span",{staticClass:"line-number"},[a._v("21")]),s("br"),s("span",{staticClass:"line-number"},[a._v("22")]),s("br"),s("span",{staticClass:"line-number"},[a._v("23")]),s("br"),s("span",{staticClass:"line-number"},[a._v("24")]),s("br"),s("span",{staticClass:"line-number"},[a._v("25")]),s("br"),s("span",{staticClass:"line-number"},[a._v("26")]),s("br"),s("span",{staticClass:"line-number"},[a._v("27")]),s("br"),s("span",{staticClass:"line-number"},[a._v("28")]),s("br"),s("span",{staticClass:"line-number"},[a._v("29")]),s("br"),s("span",{staticClass:"line-number"},[a._v("30")]),s("br"),s("span",{staticClass:"line-number"},[a._v("31")]),s("br"),s("span",{staticClass:"line-number"},[a._v("32")]),s("br"),s("span",{staticClass:"line-number"},[a._v("33")]),s("br"),s("span",{staticClass:"line-number"},[a._v("34")]),s("br"),s("span",{staticClass:"line-number"},[a._v("35")]),s("br"),s("span",{staticClass:"line-number"},[a._v("36")]),s("br"),s("span",{staticClass:"line-number"},[a._v("37")]),s("br"),s("span",{staticClass:"line-number"},[a._v("38")]),s("br"),s("span",{staticClass:"line-number"},[a._v("39")]),s("br"),s("span",{staticClass:"line-number"},[a._v("40")]),s("br"),s("span",{staticClass:"line-number"},[a._v("41")]),s("br")])]),s("h2",{attrs:{id:"_3-执行数据库初始化指令"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-执行数据库初始化指令"}},[a._v("#")]),a._v(" 3.执行数据库初始化指令")]),a._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("python manager.py db init\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("ul",[s("li",[s("p",[a._v("此时你会发现你的项目目录中出现了一个好玩儿的东西")]),a._v(" "),s("p",[a._v("![1568900286654](C:\\Users\\big cattle\\AppData\\Roaming\\Typora\\typora-user-images\\1568900286654.png)")])]),a._v(" "),s("li",[s("p",[a._v("你的版本控制器已经做好了...剩下的就是Django那一套,不再累述")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);