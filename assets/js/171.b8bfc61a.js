(window.webpackJsonp=window.webpackJsonp||[]).push([[171],{492:function(s,a,t){"use strict";t.r(a);var e=t(3),r=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"主从架构优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主从架构优点"}},[s._v("#")]),s._v(" 主从架构优点")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("数据安全，可以进行数据的备份。")])]),s._v(" "),a("li",[a("p",[s._v("读写分离，大部分的业务系统来说都是读数据多，写数据少，当访问压力过大时，可以把读请求给到从服务器。从而缓解数据库访问的压力")])]),s._v(" "),a("li",[a("p",[s._v("故障转移(高可用)，当主节点宕机之后，将从服务切换为主节点继续提供服务。当然要实现主从切换还需要其他中间件来实现。")])])]),s._v(" "),a("h2",{attrs:{id:"主从搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#主从搭建"}},[s._v("#")]),s._v(" 主从搭建")]),s._v(" "),a("h3",{attrs:{id:"_1-拉取镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-拉取镜像"}},[s._v("#")]),s._v(" 1. 拉取镜像")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker pull bigox/mysql5.7:v1.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2-启动镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动镜像"}},[s._v("#")]),s._v(" 2. 启动镜像")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# master")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --name mysql-33070 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33070")]),s._v(":3306 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Abcd@123456 -d -v /data/mysql/conf:/etc/mysql/conf.d -v /data/mysql/data/:/var/lib/mysql --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always mysql5.7:v1.0\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# slave")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --name mysql-33071 -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33071")]),s._v(":3306 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Abcd@123456 -d -v /data/mysql/conf:/etc/mysql/conf.d -v /data/mysql/data/:/var/lib/mysql --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always mysql5.7:v1.0\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_3-配置文件修改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置文件修改"}},[s._v("#")]),s._v(" 3. 配置文件修改")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("master")]),s._v(" "),a("ul",[a("li",[a("p",[a("code",[s._v("docker exec -it mysql-33070 /bin/bash")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("apt-get update && apt-get install -y vim net-tools")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("cd /etc/mysql")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("vim ./my.conf")])])]),s._v(" "),a("li",[a("p",[s._v("添加配置")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 同一局域网内注意要唯一")]),s._v("\nserver-id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 开启二进制日志功能，可以随便取（关键）")]),s._v("\nlog-bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("master-bin\nbinlog-format"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ROW     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 二级制日志格式，有三种 row，statement，mixed")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# binlog-do-db=数据库名  # 同步的数据库名称,如果不配置，表示同步所有的库")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("service mysql restart")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("docker start mysql-33070")])])])])]),s._v(" "),a("li",[a("p",[s._v("slave")])]),s._v(" "),a("li",[a("ul",[a("li",[a("p",[a("code",[s._v("docker exec -it mysql-33071 /bin/bash")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("apt-get update && apt-get install -y vim net-tools")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("cd /etc/mysql")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("vim ./my.conf")])])]),s._v(" "),a("li",[a("p",[s._v("添加配置")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 设置server_id,注意要唯一")]),s._v("\nserver-id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 开启二进制日志功能，以备Slave作为其它Slave的Master时使用")]),s._v("\nlog-bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql-slave-bin   \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## relay_log配置中继日志")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("relay_log")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql-relay-bin  \n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("read_only")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 设置为只读,该项如果不设置，表示slave可读可写")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("service mysql restart")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("docker start mysql-33071")])])])])])]),s._v(" "),a("h3",{attrs:{id:"_4-开启master-slave主从复制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-开启master-slave主从复制"}},[s._v("#")]),s._v(" 4. 开启Master-Slave主从复制")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("在master输入查询语句查看master 状态"),a("code",[s._v("show master status;")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/hellolib/pictures/main/Typora/pic-00-gitee/image-20220428155748060.png",alt:"image-20220428155748060"}})])]),s._v(" "),a("li",[a("p",[s._v("在slave库上")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("设置slave库, master_host 为docker mysql主节点ip,需要再镜像内部查看, 注意端口;")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("change master "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" master_host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'172.17.0.2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nmaster_user"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nmaster_password"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Abcd@123456'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nmaster_port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nmaster_log_file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'master-bin.000001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\nmaster_log_pos"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("154")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("start slave;")])])]),s._v(" "),a("li",[a("p",[a("code",[s._v("show slave status;")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/hellolib/pictures/main/Typora/pic-00-gitee/image-20220428160017620.png",alt:"image-20220428160017620"}})])]),s._v(" "),a("li",[a("blockquote",[a("p",[s._v("停止主从复制: "),a("code",[s._v("stop slave")])])])])])])]),s._v(" "),a("blockquote",[a("p",[s._v("大功告成~!")])])])}),[],!1,null,null,null);a.default=r.exports}}]);