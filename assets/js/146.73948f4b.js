(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{467:function(s,a,n){"use strict";n.r(a);var e=n(3),t=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"一-drf之版本控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一-drf之版本控制"}},[s._v("#")]),s._v(" 一.DRF之版本控制")]),s._v(" "),a("h2",{attrs:{id:"_1-为什么要有版本控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-为什么要有版本控制"}},[s._v("#")]),s._v(" 1.为什么要有版本控制?")]),s._v(" "),a("p",[s._v("API版本控制允许我们在不同的客户端之间更改行为(同一个接口的不同版本会返回不同的数据). DRF提供了许多不同的版本控制方案.")]),s._v(" "),a("p",[s._v("可能会有一些客户端因为某些原因不再维护了, 但是我们后端的接口还要不断的更新迭代, 这个时候通过版本控制返回不同的内容就是一种不错的解决方案.")]),s._v(" "),a("h2",{attrs:{id:"_2-drf提供的版本控制方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-drf提供的版本控制方案"}},[s._v("#")]),s._v(" 2.DRF提供的版本控制方案")]),s._v(" "),a("p",[s._v("DRF提供了五种版本控制方案, 如下:")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1464512/201901/1464512-20190119214223577-449251934.png",alt:"img"}})]),s._v(" "),a("h2",{attrs:{id:"_3-版本的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-版本的使用"}},[s._v("#")]),s._v(" 3.版本的使用")]),s._v(" "),a("h3",{attrs:{id:"_3-1全局配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1全局配置"}},[s._v("#")]),s._v(" 3.1全局配置")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("settings.py")]),s._v("文件中进行全局配置")])]),s._v(" "),a("p",[s._v("除非明确设置, 否则"),a("code",[s._v("DEFAULT_VERSIONING_CLASS")]),s._v("值为None, 此例中的"),a("code",[s._v("request.version")]),s._v("将会始终返回None.")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("REST_FRAMEWORK "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置默认使用的版本控制方案: URLPathVersioning")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'DEFAULT_VERSIONING_CLASS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rest_framework.versioning.URLPathVersioning'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'DEFAULT_VERSION'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'v1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认的版本")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ALLOWED_VERSIONS'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'v1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'v2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有效的版本")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'VERSION_PARAM'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'version'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 版本的参数名与URL conf中一致")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("ol",[a("li",[a("code",[s._v("urls.py")]),s._v("文件中:")])]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("urls "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" url\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("contrib "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" admin\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" bms "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" views\n\nurlpatterns "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("r'^admin/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("site"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("urls"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n    url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("r'^(?P<version>[v1|v2]+)/book/$'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 版本的参数名与URL conf中一致")]),s._v("\n        views"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BookViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("as_view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("actions"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'list'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'post'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'create'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("r'^(?P<version>[v1|v2]+)/book/(?P<pk>\\d+)$'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        views"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("BookViewSet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("as_view"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("actions"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'retrieve'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'put'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'update'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'delete'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'destroy'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("ol",[a("li",[a("code",[s._v("bms/views.py")]),s._v("文件中:")])]),s._v(" "),a("p",[s._v("我们在中可以通过访问"),a("code",[s._v("request.version")]),s._v("来获取当前请求的具体版本, 然后根据不同的版本来返回不同的内容.")]),s._v(" "),a("ul",[a("li",[s._v("只要在"),a("code",[s._v("settings.py")]),s._v("中配置了版本信息, 在视图("),a("code",[s._v("bms/views.py")]),s._v(")中就能通过"),a("code",[s._v("request.version")]),s._v("获取当前版本")]),s._v(" "),a("li",[a("code",[s._v("get_serilaizer_class")]),s._v("方法可以根据不同版本返回不同的序列化类")]),s._v(" "),a("li",[a("code",[s._v("get_queryset")]),s._v("方法可以根据不同的版本返回不同的数据控制")])]),s._v(" "),a("p",[s._v("思考: 为什么可以直接用"),a("code",[s._v("request.version")]),s._v("拿到版本号? --\x3e 这就是我们看源码的目的")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('from bms import models\nfrom bms.modelserializers import BookModelSerializer\nfrom rest_framework.viewsets import ModelViewSet\n\n\nclass BookViewSet(ModelViewSet):\n    queryset = models.Book.objects.all()\n    serializer_class = BookModelSerializer\n\n    def get_serializer_class(self):\n        """不同版本 使用不同的序列化类"""\n        if self.request.version == \'v1\':\n            return BookModelSerializer1\n        return self.serializer_class\n\n    def get_queryset(self):\n        """不同的版本可以 返回不同的数据控制"""\n        if self.request.version == \'v1\':\n            return models.Book.objects.all()[:3]\n        return self.queryset.all()\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h3",{attrs:{id:"_3-2局部配置-使用较少"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2局部配置-使用较少"}},[s._v("#")]),s._v(" 3.2局部配置(使用较少)")]),s._v(" "),a("p",[s._v("我们可以在一个单独的视图上设置版本控制方案. 通常, 我们==不需要这样做==, 因为在全局范围内使用一个版本控制方案更有意义. 如果我们确实需要这样做, 请使用"),a("code",[s._v("versioning_class")]),s._v("属性.")]),s._v(" "),a("ol",[a("li",[s._v("导入版本控制方案:"),a("code",[s._v("from rest_framework.versioning import 版本控制方案")])]),s._v(" "),a("li",[a("code",[s._v("versioning_class=版本控制方案")])]),s._v(" "),a("li",[s._v("定义 "),a("code",[s._v("get_queryset")]),s._v("方法 或 "),a("code",[s._v("get_serializer_class")]),s._v("方法")])]),s._v(" "),a("p",[s._v("==注意==: 版本控制方案有五种")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# AcceptHeaderVersioning\n# -- 将版本信息放在请求头中\n\nURLPathVersioning\n# -- 将版本信息放在URL中,如: 127.0.0.1:8000/v1/book\n\nNamespaceVersioning\n# -- 通过namespace来区分版本\n\nHostNameVersioning\n# -- 通过主机名来区分版本\n\nQueryParameterVersioning\n# -- 通过URL查询参数来区分版本 如: 127.0.0.1:8000/authors/?version=1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[a("code",[s._v("my_app/views.py")]),s._v("文件中:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# 第一步\nfrom rest_framework.versioning import URLPathVersioning\nclass AuthorViewSet(ModelViewSet):\n    queryset = models.Author.objects.all()\n    serializer_class = AuthorModelSerializer\n    \n    # 第二步\n    versioning_class = URLPathVersioning\n\n    # 第三步\n    def get_queryset(self):\n        """不同的版本可以 返回不同的数据控制量"""\n        pass\n    \n    # 第三步\n    def get_serializer_class(self):\n        """不同版本 使用不同的序列化类"""\n        pass\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[a("code",[s._v("urls.py")]),s._v("文件中:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from django.conf.urls import url\nfrom bms import views\nurlpatterns = [\n    url(r'^(?P<version>[v1|v2]+)/authors/$',\n        views.AuthorViewSet.as_view(actions={'get': 'list', 'post': 'create'})),\n    url(r'^(?P<version>[v1|v2]+)/authors/(?P<pk>\\d+)$',\n        views.AuthorViewSet.as_view(actions={'get': 'retrieve', 'put': 'update', 'delete': 'destroy'})),\n]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h1",{attrs:{id:"二-drf之认证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二-drf之认证"}},[s._v("#")]),s._v(" 二.DRF之认证")]),s._v(" "),a("p",[s._v("身份验证是将==传入请求==与==一组标识凭据(如请求来自的用户或其签名的令牌)==相关联的机制. 然后 权限 和 限制 组件决定是否拒绝这个请求.")]),s._v(" "),a("p",[s._v("简单来说:")]),s._v(" "),a("ul",[a("li",[s._v("认证 -- 确定了你是谁")]),s._v(" "),a("li",[s._v("权限 -- 确定你能不能访问某个接口")]),s._v(" "),a("li",[s._v("限制 -- 确定你访问某个接口的频率")])]),s._v(" "),a("p",[a("strong",[s._v("认证的目的")]),s._v(": 告诉服务端你是谁")]),s._v(" "),a("p",[a("strong",[s._v("思考")]),s._v(": 有个问题, 我们的Django和Vue项目是分离的, 它们很可能是建立在两个不同的服务器上的, 这种前后端分离的情况我们该怎样存cookie和session呢? 对于这种情况, 我们一般是通过Vue发ajax请求来把数据保存到cookie/session中的. 还有一种解决办法, 当前端请求到来时, 前端发送过来一个==token==值给后端, 后端通过查询这个token值(数据库中匹配)就可以确定你是谁了.")]),s._v(" "),a("p",[a("strong",[s._v("总结")]),s._v(": 我们通过token值来确定前端来访问的用户是谁.")]),s._v(" "),a("h2",{attrs:{id:"_1-内置的认证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-内置的认证"}},[s._v("#")]),s._v(" 1.内置的认证")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1464512/201901/1464512-20190119214250229-689042602.png",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1464512/201901/1464512-20190119215142560-1613801912.png",alt:"img"}})]),s._v(" "),a("h2",{attrs:{id:"_2-步骤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-步骤"}},[s._v("#")]),s._v(" 2.步骤")]),s._v(" "),a("p",[s._v("1.新创建一个app: "),a("code",[s._v("auth_demo")])]),s._v(" "),a("p",[s._v("2.在"),a("code",[s._v("settings.py")]),s._v("中注册"),a("code",[s._v("auth_demo")]),s._v("这个app")]),s._v(" "),a("p",[s._v("3."),a("code",[s._v("auth_demo/models.py")]),s._v("中的表结构设计:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from django.db import models\n\n# 用户表\nclass UserInfo(models.Model):\n    name = models.CharField(max_length=32)\n    pwd = models.CharField(max_length=32)\n    vip = models.BooleanField(default=False)\n    token = models.CharField(max_length=128, null=True, blank=True)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("4.二级路由")]),s._v(" "),a("p",[s._v("根目录下的"),a("code",[s._v("urls.py")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from django.conf.urls import url, include\n\nurlpatterns = [\n    url(r'^users/', include('auth_demo.urls')),\n]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("code",[s._v("auth_demo/urls.py")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from django.conf.urls import url\nfrom auth_demo import views\n\nurlpatterns = [\n    url(r'reg/$', views.RegView.as_view()),  # 注册\n    url(r'login/$', views.LoginView.as_view()),  # 登录\n    url(r'test_auth/$', views.TestAuthView.as_view()),  # 测试登录认证\n]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[s._v("5.视图函数 "),a("code",[s._v("auth_demo/views.py")]),s._v(":")]),s._v(" "),a("p",[a("code",[s._v("注册")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from rest_framework.views import APIView\nfrom rest_framework.response import Response\nfrom auth_demo import models\n\n\nclass RegView(APIView):\n    \"\"\"只支持注册用户\"\"\"\n\n    def post(self, request):\n        # 1.获取用户注册的数据\n        name = request.data.get('name')\n        pwd = request.data.get('pwd')\n        re_pwd = request.data.get('re_pwd')\n        if name and pwd:\n            # 2.判断密码和确认密码是否一致\n            if pwd == re_pwd:\n                # 3.创建用户\n                models.UserInfo.objects.create(name=name, pwd=pwd)\n                # 4.返回响应\n                return Response('注册成功')\n            else:\n                return Response('两次密码不一致')\n        else:\n            return Response('无效的参数')\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[a("code",[s._v("登录")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class LoginView(APIView):\n    \"\"\"只支持用户登录\"\"\"\n\n    def post(self, request):\n        # 1.通过request.data获取前端提交的数据\n        name = request.data.get('name')\n        pwd = request.data.get('pwd')\n        if name and pwd:\n            # 2.从数据库中进行筛选匹配\n            user_obj = models.UserInfo.objects.filter(name=name, pwd=pwd).first()\n            if user_obj:\n                # 3.登录成功,生成token(时间戳 + Mac地址)\n                import uuid\n                token = uuid.uuid1().hex\n                # 4.把token保存到用户表中\n                user_obj.token = token\n                user_obj.save()\n                # 5.返回响应(包括状态码和token值)\n                return Response({'error_no': 0, 'token': token})\n            else:\n                # 3.用户名或密码错误,登录失败\n                return Response({'error_no': 1, 'error': '用户名或密码错误'})\n        else:\n            return Response('无效的参数')\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("6.自定义认证类 "),a("code",[s._v("auth_demo/auth.py")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from rest_framework.authentication import BaseAuthentication\nfrom rest_framework.exceptions import AuthenticationFailed\nfrom auth_demo import models\n\n\nclass MyAuth(BaseAuthentication):\n\n    def authenticate(self, request):\n        # 1.通过request.query_params获取前端的url参数\n        token = request.query_params.get('token')\n        if token:\n            # 2.如果请求的url中携带了token参数\n            user_obj = models.UserInfo.objects.filter(token=token).filter()\n            if user_obj:\n                # 3.token是有效的\n                return user_obj, token  # 必须返回一个元组: (user_obj, token) --\x3e (request.user, request.auth)\n            else:\n                raise AuthenticationFailed('无效的token')\n        else:\n            raise AuthenticationFailed('请求的URL中必须携带token参数')\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("7.局部认证 配置: "),a("code",[s._v("auth_demo/views.py")])]),s._v(" "),a("p",[s._v("注意: ==局部配置的优先级高于全局配置==")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from auth_demo.auth import MyAuth\n\n# 登录之后才能看到的数据接口\nclass TestAuthView(APIView):\n    authentication_classes = [MyAuth, ]  # 配置局部认证, 全局认证在settings.py文件中配置\n\n    def get(self, request):\n        print(request.user.name)    # request.user 用户对象\n        print(request.auth)         # reequest.auth 设置的token值\n        return Response('这个视图里面的数据只有登录以后才能看到!')\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("8.全局配置: "),a("code",[s._v("settings.py")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("REST_FRAMEWORK = {\n    'DEFAULT_AUTHENTICATION_CLASSES': ['auth_demo.auth.MyAuth', ],  # 认证 全局配置\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h1",{attrs:{id:"三-drf之权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三-drf之权限"}},[s._v("#")]),s._v(" 三.DRF之权限")]),s._v(" "),a("h2",{attrs:{id:"_1-自定义一个权限类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-自定义一个权限类"}},[s._v("#")]),s._v(" 1.自定义一个权限类")]),s._v(" "),a("p",[a("code",[s._v("auth_demo/permissions.py")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('"""\n自定义一个权限组件\n"""\nfrom rest_framework.permissions import BasePermission\nclass MyPermission(BasePermission): # 继承BasePermission\n    message = \'只有VIP才能访问\'\n\n    def has_permission(self, request, view):    # 必须实现has_permission方法\n        # 只有通过权限验证的用户才能访问has_permission方法\n        if not request.auth:    # request.auth --\x3e token值\n            return False\n        # request.user --\x3e 当前通过token认证的用户(UserInfo表中的用户对象)\n        if request.user.vip:\n            # 是VIP就通过\n            return True\n        else:\n            # 不是VIP就拒绝\n            return False\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("h2",{attrs:{id:"_2-权限-局部配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-权限-局部配置"}},[s._v("#")]),s._v(" 2.权限 局部配置")]),s._v(" "),a("p",[a("code",[s._v("auth_demo/views.py")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from auth_demo.auth import MyAuth\nfrom auth_demo.permissions import MyPermission\n\n\n# 登录之后才能看到的数据接口\nclass TestAuthView(APIView):\n    authentication_classes = [MyAuth, ]  # 配置局部认证, 全局认证在settings.py文件中配置\n    permission_classes = [MyPermission, ]   # 配置局部权限, 全局权限在settings.py文件中配置\n\n    def get(self, request):\n        print(request.user.name)\n        print(request.auth)\n        return Response('这个视图里面的数据只有登录以后才能看到!')\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h2",{attrs:{id:"_3-权限-全局配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-权限-全局配置"}},[s._v("#")]),s._v(" 3.权限 全局配置")]),s._v(" "),a("p",[a("code",[s._v("settings.py")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("REST_FRAMEWORK = {\n    'DEFAULT_AUTHENTICATION_CLASSES': ['auth_demo.auth.MyAuth', ],\n    'DEFAULT_PERMISSION_CLASSES': ['auth_demo.permissions.MyPermission', ]\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h1",{attrs:{id:"四-drf之限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四-drf之限制"}},[s._v("#")]),s._v(" 四.DRF之限制")]),s._v(" "),a("h2",{attrs:{id:"_1-使用自定义限制类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-使用自定义限制类"}},[s._v("#")]),s._v(" 1.使用自定义限制类")]),s._v(" "),a("p",[s._v("DRF内置了基本的限制类，首先我们自己动手写一个限制类，熟悉下限制组件的执行过程。")]),s._v(" "),a("h3",{attrs:{id:"_1-1自定义一个限制类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1自定义一个限制类"}},[s._v("#")]),s._v(" 1.1自定义一个限制类")]),s._v(" "),a("p",[a("code",[s._v("auth_demo/throttle.py")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('import time\n\n# 访问记录\nVISIT_RECORD = {}\nclass MyThrottle(object):\n\n    def __init__(self):\n        self.history = None\n\n    def allow_request(self, request, view):\n        # 1.拿到当前请求的ip作为VISIT_RECORD的key\n        ip = request.META.get(\'REMOTE_ADDR\')\n        # 2.拿到当前请求的时间戳\n        now = time.time()\n        # 3.如果是请求是第一次来访问\n        if ip not in VISIT_RECORD:\n            # {ip:[]}\n            VISIT_RECORD[ip] = []\n            return True\n        # 4.把当前请求的访问记录拿出来保存到一个变量(访问历史)中\n        history = VISIT_RECORD[ip]\n        self.history = history\n        # 5.循环访问历史,把超过10秒钟的请求时间去掉\n        while history and now - history[-1] > 10:\n            history.pop()\n        # 6.此时,history中只保存了最近10秒钟的访问记录\n        if len(history) >= 3:\n            # (1)history中存放了3条及以上的历史记录,拒绝访问\n            return False\n        else:\n            # (2)history中的历史记录不到3条,存储当前历史记录\n            self.history.insert(0, now)\n            return True\n\n    def wait(self):\n        """告诉客户端还需要等待多久"""\n        now = time.time()\n        return self.history[-1] + 10 - now\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("h3",{attrs:{id:"_1-2限制-局部配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2限制-局部配置"}},[s._v("#")]),s._v(" 1.2限制 局部配置")]),s._v(" "),a("p",[a("code",[s._v("auth_demo/views.py")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from auth_demo.throttle import MyThrottle\n\n\n# 登录之后才能看到的数据接口\nclass TestView(APIView):\n    throttle_classes = [MyThrottle, ]  # 配置局部限制, 全局限制在settings.py文件中配置\n\n    def get(self, request):\n        return Response('你成功了!这个视图里面的数据只有登录以后才能看到!')\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"_1-3限制-全局配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3限制-全局配置"}},[s._v("#")]),s._v(" 1.3限制 全局配置")]),s._v(" "),a("p",[a("code",[s._v("settings.py")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# 在settings.py中设置rest framework相关配置项\nREST_FRAMEWORK = {\n    'DEFAULT_AUTHENTICATION_CLASSES': ['auth_demo.auth.MyAuth', ],  # 认证 全局配置\n    'DEFAULT_PERMISSION_CLASSES': ['auth_demo.permissions.MyPermission', ],  # 权限 全局配置\n    'DEFAULT_THROTTLE_CLASSES': ['auth_demo.throttle.MyThrottle'],  # 限制 全局配置\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h2",{attrs:{id:"_2-使用内置限制类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用内置限制类"}},[s._v("#")]),s._v(" 2.使用内置限制类")]),s._v(" "),a("h3",{attrs:{id:"_2-1定义内置限制类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1定义内置限制类"}},[s._v("#")]),s._v(" 2.1定义内置限制类")]),s._v(" "),a("p",[a("code",[s._v("auth_demo/throttle.py")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('#使用内置限制类\n\nfrom rest_framework.throttling import SimpleRateThrottle\nclass VisitThrottle(SimpleRateThrottle):\n    scope = "throttle"\n\n    def get_cache_key(self, request, view):\n        return self.get_ident(request)\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"_2-2全局配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2全局配置"}},[s._v("#")]),s._v(" 2.2全局配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('REST_FRAMEWORK = {\n    # 内置限制类的全局配置\n    "DEFAULT_THROTTLE_RATES": {\n        "throttle": "5/m",  # 这里的key要与throttle.py文件中的scope="throttle"相对应\n    },\n}\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h1",{attrs:{id:"五-drf之分页"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五-drf之分页"}},[s._v("#")]),s._v(" 五.DRF之分页")]),s._v(" "),a("h2",{attrs:{id:"_1-为什么要使用分页"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-为什么要使用分页"}},[s._v("#")]),s._v(" 1.为什么要使用分页")]),s._v(" "),a("p",[s._v("我们的数据表中可能会有成千上万条数据, 当我们访问某张表的所有数据时,我们不大可能需要一次把所有数据都展示出来, 因为数据量很大, 对服务端的内存压力比较大并且网络传输过程中耗时也会比较大.")]),s._v(" "),a("p",[s._v("通常我们会希望一部分一部分去请求数据, 也就是我们常说的一页一页获取数据并展示出来.")]),s._v(" "),a("h2",{attrs:{id:"_2-drf使用分页器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-drf使用分页器"}},[s._v("#")]),s._v(" 2.DRF使用分页器")]),s._v(" "),a("h3",{attrs:{id:"_2-1分页模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1分页模式"}},[s._v("#")]),s._v(" 2.1分页模式")]),s._v(" "),a("p",[s._v("REST framework中提供了三种分页模式:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from rest_framework.pagination import PageNumberPagination, LimitOffsetPagination, CursorPagination\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_2-2全局配置-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2全局配置-2"}},[s._v("#")]),s._v(" 2.2全局配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("REST_FRAMEWORK = {\n    # 默认使用的分页类\n    'DEFAULT_PAGINATION_CLASS': 'rest_framework.pagination.PageNumberPagination',\n    # 默认每页的数据个数\n    'PAGE_SIZE': 100\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_2-3局部配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3局部配置"}},[s._v("#")]),s._v(" 2.3局部配置")]),s._v(" "),a("p",[s._v("我们可以在视图类中进行局部配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class PublisherViewSet(ModelViewSet):\n    queryset = models.Publisher.objects.all()\n    serializer_class = PublisherModelSerializer\n    pagination_class = PageNumberPagination  # 注意不是列表（只能有一个分页模式）\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_3-drf内置分页器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-drf内置分页器"}},[s._v("#")]),s._v(" 3.DRF内置分页器")]),s._v(" "),a("h3",{attrs:{id:"_3-1pagenumberpagination"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1pagenumberpagination"}},[s._v("#")]),s._v(" 3.1"),a("code",[s._v("PageNumberPagination")])]),s._v(" "),a("p",[s._v("按页码数分页, 第n页, 每页显示m条数据.")]),s._v(" "),a("p",[s._v("例如: "),a("code",[s._v("http:127.0.0.1:8000/v1/book/?page=2&size=1")])]),s._v(" "),a("h4",{attrs:{id:"分页器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分页器"}},[s._v("#")]),s._v(" 分页器")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# bms/pagination.py\n\nfrom rest_framework.pagination import PageNumberPagination\nclass MyPageNumber(PageNumberPagination):\n    page_size = 2  # 每页显示多少条\n    page_size_query_param = 'size'  # URL中每页显示条数的参数\n    page_query_param = 'page'  # URL中页码的参数\n    max_page_size = None  # 最大页码数限制\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"视图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视图"}},[s._v("#")]),s._v(" 视图")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# bms/views.py\n\nfrom bms.pagination import MyPageNumber\nclass BookViewSet(ModelViewSet):\n    queryset = models.Book.objects.all().order_by(\'id\')\n    serializer_class = BookModelSerializer\n    """\n    普通分页器\n    """\n    pagination_class = MyPageNumber\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"_3-2limitoffsetpagination"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2limitoffsetpagination"}},[s._v("#")]),s._v(" 3.2"),a("code",[s._v("LimitOffsetPagination")])]),s._v(" "),a("p",[s._v("分页, 在n位置, 向后查看m条数据.")]),s._v(" "),a("p",[s._v("例如: "),a("code",[s._v("127.0.0.1:8000/v1/book/?offset=2&limit=2")])]),s._v(" "),a("h4",{attrs:{id:"分页器-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分页器-2"}},[s._v("#")]),s._v(" 分页器")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# bms/pagination.py\n\nfrom rest_framework.pagination import LimitOffsetPagination\nclass MyLimitOffset(LimitOffsetPagination):\n    default_limit = 1\n    limit_query_param = 'limit'\n    offset_query_param = 'offset'\n    max_limit = 999\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"视图-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视图-2"}},[s._v("#")]),s._v(" 视图")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# bms/views.py\n\nfrom bms.pagination import MyLimitOffset\nclass BookViewSet(ModelViewSet):\n    queryset = models.Book.objects.all().order_by(\'id\')\n    serializer_class = BookModelSerializer\n    """\n    offset分页器\n    """\n    pagination_class = MyLimitOffset\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h3",{attrs:{id:"_3-3cursorpagination"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3cursorpagination"}},[s._v("#")]),s._v(" 3.3"),a("code",[s._v("CursorPagination")])]),s._v(" "),a("p",[s._v("加密分页, 把上一页和下一页的id值记住.")]),s._v(" "),a("h4",{attrs:{id:"分页器-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分页器-3"}},[s._v("#")]),s._v(" 分页器")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# bms/pagination.py\n\nfrom rest_framework.pagination import CursorPagination\nclass MyCursorPagination(CursorPagination):\n    cursor_query_param = 'cursor'\n    page_size = 1\n    ordering = '-id'  # 重写要排序的字段\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"视图-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#视图-3"}},[s._v("#")]),s._v(" 视图")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# bms/views.py\n\nfrom bms.pagination import MyCursorPagination\nclass BookViewSet(ModelViewSet):\n    queryset = models.Book.objects.all().order_by(\'id\')\n    serializer_class = BookModelSerializer\n    """\n    加密分页器\n    """\n    pagination_class = MyCursorPagination\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h1",{attrs:{id:"六-解析器和渲染器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六-解析器和渲染器"}},[s._v("#")]),s._v(" 六.解析器和渲染器")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/liwenzhou/p/10267985.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考资料"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("略.")]),s._v(" "),a("h1",{attrs:{id:"七-对drf中的request对象的相关总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七-对drf中的request对象的相关总结"}},[s._v("#")]),s._v(" 七.对DRF中的"),a("code",[s._v("request")]),s._v("对象的相关总结")]),s._v(" "),a("h2",{attrs:{id:"_1-查看源码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-查看源码"}},[s._v("#")]),s._v(" 1.查看源码")]),s._v(" "),a("p",[s._v("1."),a("code",[s._v("APIView")]),s._v("类")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1464512/201901/1464512-20190119214640919-984109625.png",alt:"img"}})]),s._v(" "),a("p",[s._v("2.1.1"),a("code",[s._v("initialize_request")]),s._v("方法")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1464512/201901/1464512-20190119214443267-1195601520.png",alt:"img"}})]),s._v(" "),a("p",[s._v("2.1.2"),a("code",[s._v("Request")]),s._v("类")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1464512/201901/1464512-20190119214507609-1850572750.png",alt:"img"}})]),s._v(" "),a("p",[s._v("2.2.1"),a("code",[s._v("initial")]),s._v("方法")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1464512/201901/1464512-20190119214517143-215536463.png",alt:"img"}})]),s._v(" "),a("h2",{attrs:{id:"_2-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-总结"}},[s._v("#")]),s._v(" 2.总结")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("request.data")]),s._v(" -- 前端post提交的数据")]),s._v(" "),a("li",[a("code",[s._v("request.query_params")]),s._v(" -- 前端页面的url参数")]),s._v(" "),a("li",[a("code",[s._v("request.user")]),s._v(" -- 通过认证的用户对象")]),s._v(" "),a("li",[a("code",[s._v("request.auth")]),s._v(" -- 前端发过来的token值")]),s._v(" "),a("li",[a("code",[s._v("request.version")]),s._v(" -- 版本号(如: v1, v2)")]),s._v(" "),a("li",[a("code",[s._v("requst.versioning_scheme")]),s._v(" -- 版本控制方案(5个)")])]),s._v(" "),a("h1",{attrs:{id:"八-版本-认证-权限-限制-分页-源码查看方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#八-版本-认证-权限-限制-分页-源码查看方法"}},[s._v("#")]),s._v(" 八.版本,认证,权限,限制,分页 -- 源码查看方法")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from rest_framework.versioning import *      # 查看 版本 源码\nfrom rest_framework.authentication import *  # 查看 认证 源码\nfrom rest_framework.permissions import *     # 查看 权限 源码\nfrom rest_framework.throttling import *      # 查看 限制 源码\nfrom rest_framework.pagination import *      # 查看 分页 源码\n\nfrom django.core.handlers.wsgi import WSGIRequest   # 查看Django自己的request 源码\n\nfrom rest_framework import settings # 查看settings.py文件中的配置项(版本,认证,权限,等等)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h1",{attrs:{id:"九-补充知识"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#九-补充知识"}},[s._v("#")]),s._v(" 九.补充知识")]),s._v(" "),a("h2",{attrs:{id:"_1-issubset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-issubset"}},[s._v("#")]),s._v(" 1."),a("code",[s._v("issubset()")])]),s._v(" "),a("p",[a("strong",[s._v("描述:")]),s._v(" "),a("code",[s._v("issubset()")]),s._v("方法用于判断集合的所有元素是否都包含在指定集合中, 如果是则返回True, 否则返回False.")]),s._v(" "),a("p",[a("strong",[s._v("语法:")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("set.issubset(set)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("参数:")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("set")]),s._v(" -- 必需, 要比较查找的集合")])]),s._v(" "),a("p",[a("strong",[s._v("返回值:")]),s._v(" 返回布尔值, 如果都包含返回True, 否则返回False.")]),s._v(" "),a("p",[a("strong",[s._v("实例说明:")]),s._v(" 判断集合x的所有元素是否都包含在集合u中.")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('x = {"a", "b", "c"}\ny = {"f", "e", "d", "c", "b", "a"}\nz = x.issubset(y)\nprint(z)\n\n# 执行结果:\n# True\nx = {"a", "b", "c"}\ny = {"f", "e", "d", "c", "b"}\nz = x.issubset(y)\nprint(z)\n\n# 执行结果:\n# False\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h2",{attrs:{id:"_2-语法糖setter-getter-deleter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-语法糖setter-getter-deleter"}},[s._v("#")]),s._v(" 2.语法糖"),a("code",[s._v("setter")]),s._v(","),a("code",[s._v("getter")]),s._v(","),a("code",[s._v("deleter")])]),s._v(" "),a("p",[a("strong",[s._v("实例说明:")])]),s._v(" "),a("ul",[a("li",[s._v("例1:")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class Person:\n    def __init__(self, name):\n        self.name = name\n\np1 = Person('王乃卉')\nprint(p1.name)\n\n# 执行结果:\n# 王乃卉\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("ul",[a("li",[s._v("例2:")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class Person:\n\n    def __init__(self, name):\n        self.name = name\n\n    @property   # getter -- 获取属性\n    def age(self):\n        print('get age called')\n        return self._age\n\n    @age.setter # setter -- 设置属性\n    def age(self, value):\n        print('set age called')\n        if not isinstance(value, int):\n            raise TypeError('Excepted an int')\n        self._age = value\n\n\np2 = Person('王力宏')  # 实例化\np2.age = 19     # 设置属性\nprint(p2.age)   # 获取属性\n\n##执行结果:\n# set age called\n# get age called\n# 19\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("ul",[a("li",[s._v("例3:")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class Person:\n\n    def __init__(self, age):\n        self.age = age\n\n    @property   # getter -- 获取属性\n    def age(self):\n        print('get age called')\n        return self._age\n\n    @age.setter # setter -- 设置属性\n    def age(self, value):\n        print('set age called')\n        if not isinstance(value, int):\n            raise TypeError('Excepted an int')\n        self._age = value\n\n\np3 = Person(19)     # 实例化,设置属性\nprint(p3.age)       # 获取属性\n\np3.age = 22         # 设置属性\nprint(p3.age)       # 获取属性\n\n##执行结果:\n# set age called\n# get age called\n# 19\n# set age called\n# get age called\n# 22\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("ul",[a("li",[s._v("例4:")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class Person:\n    def __init__(self):\n        self.__name = None\n\n    @property       # 访问属性\n    def name(self):\n        return self.__name\n\n    @name.setter    # 设置属性\n    def name(self, value):\n        self.__name = value\n\n    @name.deleter   # 删除属性\n    def name(self):\n        del self.__name\n\np = Person()\nprint(p.name)     # 访问属性 --\x3e None\np.name = '王乃卉'  # 设置属性\nprint(p.name)     # 访问属性 --\x3e 王乃卉\ndel p.name        # 删除属性\n#print(p.name)    # 访问属性 --\x3e 报错: 对象没有该属性\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h2",{attrs:{id:"_3-orm之update-or-create"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-orm之update-or-create"}},[s._v("#")]),s._v(" 3.ORM之"),a("code",[s._v("update_or_create()")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('# 检查是否有这条记录,有则更新(需要defaults参数,字典类型),无则新增\nmodels.UserToken.objects.update_or_create(user=user_obj, defaults={\n    "token": access_token\n})\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"_4-assert断言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-assert断言"}},[s._v("#")]),s._v(" 4."),a("code",[s._v("assert")]),s._v("断言")]),s._v(" "),a("p",[s._v("根据"),a("a",{attrs:{href:"https://docs.python.org/3/reference/simple_stmts.html#assert",target:"_blank",rel:"noopener noreferrer"}},[s._v("Python 官方文档解释"),a("OutboundLink")],1),s._v(" : "),a("code",[s._v('"Assert statements are a convenient way to insert debugging assertions into a program".')])]),s._v(" "),a("p",[s._v("语法:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("assert condition\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("用来让程序测试这个"),a("code",[s._v("condition")]),s._v(", 如果"),a("code",[s._v("condition")]),s._v("为False, 则raise一个"),a("code",[s._v("AssertionError")]),s._v("出来. 逻辑上等同于:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("if not condition:\n    raise AssertionError('error_message')\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("实例说明:")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('>>> assert 1==1\n>>> assert 1==0\nTraceback (most recent call last):\n  File "<input>", line 1, in <module>\nAssertionError\n\n>>> assert True\n>>> assert False\nTraceback (most recent call last):\n  File "<input>", line 1, in <module>\nAssertionError\n\n>>> assert 1<2\n>>> assert 1>2\nTraceback (most recent call last):\n  File "<input>", line 1, in <module>\nAssertionError\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h2",{attrs:{id:"_5-while循环测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-while循环测试"}},[s._v("#")]),s._v(" 5.while循环测试")]),s._v(" "),a("p",[s._v("对比以下两个例子并思考为什么执行结果会不同.")]),s._v(" "),a("ul",[a("li",[s._v("例1:")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("lst1 = []\nwhile lst1[-1] and lst1:\n    print('这里是lst1')\n\n# 执行结果:\n# IndexError: list index out of range\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ul",[a("li",[s._v("例2:")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("lst2 = []\nwhile lst2 and lst2[-1]:\n    print('这里是lst2')\n\n# 由于lst2为空,所以不执行while循环\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);