(window.webpackJsonp=window.webpackJsonp||[]).push([[242],{563:function(s,t,a){"use strict";a.r(t);var n=a(3),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"一-docke基础"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一-docke基础"}},[s._v("#")]),s._v(" 一. Docke基础")]),s._v(" "),t("h2",{attrs:{id:"_1-前戏"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-前戏"}},[s._v("#")]),s._v(" 1. 前戏")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("什么是docker?")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("docker将应用程序与程序的依赖，打包在一个文件里面。运行这个文件就会生成一个虚拟容器。\n程序运行在虚拟容器里，如同在真实物理机上运行一样，有了docker，就不用担心环境问题了。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("应用场景")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("web应用的自动化打包和发布\n自动化测试和持续集成、发布\n在服务型环境中部署和调整数据库或其他应用\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("docker与虚拟机的区别")]),s._v(" "),t("ul",[t("li",[s._v("物理机")])]),s._v(" "),t("img",{staticStyle:{zoom:"33%"},attrs:{src:"https://raw.githubusercontent.com/hellolib/pictures/main/Typora/pic-00-gitee/v2-2a05f6b780ea9692a459477bbda7b066_1440w.jpg",alt:"img"}}),s._v(" "),t("ul",[t("li",[t("p",[s._v("虚拟机")]),s._v(" "),t("img",{staticStyle:{zoom:"33%"},attrs:{src:"https://raw.githubusercontent.com/hellolib/pictures/main/Typora/pic-00-gitee/v2-a4bd3589de0a0536d73fd53f3403adff_1440w-20211224094557010.jpg"}})]),s._v(" "),t("li",[t("p",[s._v("容器")])])]),s._v(" "),t("img",{staticStyle:{zoom:"40%"},attrs:{src:"https://raw.githubusercontent.com/hellolib/pictures/main/Typora/pic-00-gitee/v2-b9430887dc90820af97bb2d35854e34d_1440w.jpg"}})]),s._v(" "),t("li",[t("p",[s._v("docker的三大概念镜像,容器,仓库")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#镜像")]),s._v("\n镜像文件"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("可以理解为操作系统的centos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("iso文件"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n例如：一个镜像可以包含一个完整的CentOS操作系统环境，里面仅安装了Apache或用户需要的其他应用程序。\n镜像可以用来创建Docker容器。\nDocker提供了一个很简单的机制来创建镜像或者更新现有的镜像，用户甚至可以直接从其他人那里下载一个已经做好的镜像来直接使用。\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器")]),s._v("\n容器实例"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("基于docker镜像运行出的容器实例"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("可以理解为微型操作系统\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#仓库")]),s._v("\n仓库"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 存储镜像文件的地方\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"_2-docker与虚拟机的对比"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-docker与虚拟机的对比"}},[s._v("#")]),s._v(" 2. docker与虚拟机的对比")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("特性")]),s._v(" "),t("th",[s._v("容器")]),s._v(" "),t("th",[s._v("虚拟机")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("启动")]),s._v(" "),t("td",[s._v("秒级")]),s._v(" "),t("td",[s._v("分钟级")])]),s._v(" "),t("tr",[t("td",[s._v("硬盘使用")]),s._v(" "),t("td",[s._v("一般为 MB")]),s._v(" "),t("td",[s._v("一般为 GB")])]),s._v(" "),t("tr",[t("td",[s._v("性能")]),s._v(" "),t("td",[s._v("接近原生")]),s._v(" "),t("td",[s._v("弱")])]),s._v(" "),t("tr",[t("td",[s._v("系统支持量")]),s._v(" "),t("td",[s._v("单机支持上千个容器")]),s._v(" "),t("td",[s._v("一般几十个")])])])]),s._v(" "),t("ul",[t("li",[t("p",[t("strong",[s._v("Linux容器不是模拟一个完整的操作系统，而是对进程进行隔离。在正常进程的外面套了一个保护层，对于容器里面进程来说，它接触的资源都是虚拟的，从而实现和底层系统的隔离。")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.githubusercontent.com/hellolib/pictures/main/Typora/pic-00-gitee/1633666-20190921213513395-1295770811.png",alt:"img"}})])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("镜像作为标准的交付件，可在开发、测试和生产环境上以容器来运行，最终实现三套环境上的应用以及运行所依赖内容的完全一致。")])])]),s._v(" "),t("li",[t("p",[s._v("那么你肯定看出了"),t("strong",[s._v("docker的优势")]),s._v(":")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("更高效的利用系统资源\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("更快速的启动时间\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("一致的运行环境\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v("持续交付和部署\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v("更轻松的迁移\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"_3-安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装"}},[s._v("#")]),s._v(" 3. 安装")]),s._v(" "),t("h3",{attrs:{id:"_3-1-安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-安装docker"}},[s._v("#")]),s._v(" 3.1 安装docker")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("yum安装"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("配置yum仓库\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("阿里云仓库"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("清华源仓库"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("163")]),s._v("仓库"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" 问题是"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("docker的版本可能很低"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("有很多漏洞\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("选择软件官方提供的yum仓库"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("版本都是最新的"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("但是可能下载较慢\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("由于网速问题"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("学习阶段还是使用阿里云的docker\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("rpm 不推荐\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("源码编译安装"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("很麻烦"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("如果没有特定需求"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("还是选择yum正确姿势"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("那么下面就是用正确姿势,安装docker")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.卸载旧版本")]),s._v("\nsudo yum remove docker \\\n                  docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client \\\n                  docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("latest \\\n                  docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("common \\\n                  docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("latest \\\n                  docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("latest"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("logrotate \\\n                  docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("logrotate \\\n                  docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("selinux \\\n                  docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("engine"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("selinux \\\n                  docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("engine\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.设置存储库")]),s._v("\nsudo yum install "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y yum"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("utils \\\n  device"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("mapper"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("persistent"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("data \\\n  lvm2\n\nsudo yum"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("config"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("manager \\\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("add"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("repo \\\n    https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("download"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("linux"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("centos"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ce"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repo\n      \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#3.安装docker社区版")]),s._v("\nsudo yum install docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ce\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#4.启动关闭docker")]),s._v("\nsystemctl start docker\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v(" systemctl status"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("start"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("stop docker  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#看状态/启动/停止")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("p",[t("strong",[s._v("ps:docker最低支持centos7且在64位平台上，内核版本在3.10以上")])]),s._v(" "),t("h3",{attrs:{id:"_3-2-docker基础命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-docker基础命令"}},[s._v("#")]),s._v(" 3.2 docker基础命令")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("加速配置")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#一条命令加速")]),s._v("\ncurl "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sSL https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("get"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("daocloud"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daotools"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("set_mirror"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sh "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("//")]),s._v("fgds5u3j"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("mirror"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("aliyuncs"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("增, 获取镜像文件 ,centos或者ubuntu 系统等等镜像")]),s._v(" "),t("ul",[t("li",[s._v("docker pull  镜像文件名   \t\t#下载docker镜像")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("docker  run  hello"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("world   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行镜像文件,生成docker容器实例,docker run命令,会自动下载不存在的镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器是随时创建,随时删除的,轻量级,每次docker run 都会生成新的容器记录 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker容器进程,如果没有在后台运行的话,就会立即挂掉,  (容器中必须有正在工作的进程)")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行一个活着的容器进程")]),s._v("\ndocker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d centos "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sh "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"while true;do echo '你个糟老头子,不听课,坏得很'; sleep 1;done\"")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行镜像  ")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d  后台运行的意思\n\t centos  指的是镜像文件名  \n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("sh  要在这个容器内运行的命令"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("指定的解释器 shell解释器 \n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c  指定一段shell代码 \n\t\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入容器空间内的命令 ")]),s._v("\ndocker "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exec")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("it 容器"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bash  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入容器空间内 ")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("i 交互式命令操作\n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t 开启一个新的终端\n    exit 退出虚拟容器\n\t\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#运行一个ubuntu容器")]),s._v("\ndocker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("it ubuntu  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("删")]),s._v(" "),t("ul",[t("li",[s._v("查看容器运行// systemctl status/start/stop docker  #看状态/启动/停止")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("docker rmi  镜像名字"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("镜像"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除镜像文件 ")]),s._v("\ndocker rm  容器"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("容器进程名字   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#删除容器记录")]),s._v("\ndocker rmi "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#强制删除镜像文件  ")]),s._v("\ndocker  rm  `docker ps "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("aq`   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#批量删除容器记录,只能删除挂掉的容器记录 ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("改")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#docker容器进程的启停命令")]),s._v("\ndocker start  容器"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v(" \ndocker stop  容器"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("查")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("docker search  镜像文件名字   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#搜索镜像文件")]),s._v("\ndocker images  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列出当前所有的镜像文件 ")]),s._v("\ndocker ps   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列出当前记录正在运行的容器进程 ")]),s._v("\ndocker ps "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("a  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列出所有的容器进程,以及挂掉的  ")]),s._v("\n\ndocker logs 容器"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看容器内的日志信息 ")]),s._v("\ndocker logs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f  容器"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#检测容器内的日志 ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])])]),s._v(" "),t("h2",{attrs:{id:"_4-容器镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-容器镜像"}},[s._v("#")]),s._v(" 4. 容器镜像")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("容器镜像就是容器进程,基于容器镜像文件运行出的")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("docker镜像就是python的 类"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("基于这个类可以无限的实例化\ndocker的容器就是 类的实例化对象 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"_4-1-提交自定制的镜像文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-提交自定制的镜像文件"}},[s._v("#")]),s._v(" 4.1 提交自定制的镜像文件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 流程:")]),s._v("\n运行出容器实例  二次修改容器实例  提交容器实例为新的镜像  导出镜像 发给别人导入\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",[t("li",[t("p",[s._v("docker run -it centos /bin/bash     #进入一个纯净的centos容器空间内,此时是最小化安装的系统,没有vim 没有py3")])]),s._v(" "),t("li",[t("p",[s._v("在容器空间内  yum install vim   ,然后退出容器")])]),s._v(" "),t("li",[t("p",[s._v("此时这个容器记录就是携带者 vim的容器记录了(可以理解为携带者程序依赖,或者python3等等)")])]),s._v(" "),t("li",[t("p",[s._v("提交这个容器为新的 镜像文件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  docker commit 容器进程id    镜像文件的名字 ")]),s._v("\ndocker commit "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("419")]),s._v("  s21docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("centos"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("vim \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("导出docker镜像,成为一个压缩文件,可以发送给你的测试,运维同事了")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("docker save 镜像文件名  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("s21"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("centos"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("vim"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gz  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("此时可以发送文件,给别人导入了")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("docker load "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("  同事给你发的镜像文件\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"_4-2-容器内运行一个web程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-容器内运行一个web程序"}},[s._v("#")]),s._v(" 4.2 容器内运行一个web程序")]),s._v(" "),t("ul",[t("li",[s._v("容器内运行一个web程序 ,进行端口映射")])]),s._v(" "),t("ol",[t("li",[t("p",[s._v("下载一个flask的docker镜像")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("docker pull training"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("webapp\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("运行docker镜像")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d -P  ")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d  后台运行 \n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P  随机端口映射   随机的宿主机的端口"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("容器内的端口"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("自动指定的"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("由代码指定"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p  指定端口映射   宿主机的"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7777")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8500")]),s._v("\ndocker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("P training"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("webapp python app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建一个容器空间,然后在里面执行 python app.py 命令")]),s._v("\ndocker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" training"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("webapp python app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建一个容器空间,然后在里面执行 python app.py 命令")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("访问这个容器应用 : 服务器ip:宿主机的映射端口")])])]),s._v(" "),t("ul",[t("li",[s._v("123.206.16.61:32768")])]),s._v(" "),t("ol",{attrs:{start:"4"}},[t("li",[t("p",[s._v("进入容器空间内,查看代码")]),s._v(" "),t("ul",[t("li",[s._v("docker exec -it 容器id  /bin/bash")])])])]),s._v(" "),t("h3",{attrs:{id:"_4-3-dockerfile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-dockerfile"}},[s._v("#")]),s._v(" 4.3 dockerfile")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("dockerfile学习,docker的脚本文件,用于构建镜像文件的")])]),s._v(" "),t("li",[t("p",[s._v("镜像是容器的基础，每次执行docker run的时候都会指定哪个镜像作为容器运行的基础。我们之前的例子都是使用来自docker hub的镜像，直接使用这些镜像只能满足一定的需求，当镜像无法满足我们的需求时，就得自定制这些镜像。")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("FROM scratch "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 制作base image 基础镜像，尽量使用官方的image作为base image")]),s._v("\nFROM centos "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用base image")]),s._v("\nFROM ubuntu"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.04")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#带有tag的base image")]),s._v("\n\nLABEL version"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("“"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("” "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#容器元信息，帮助信息，Metadata，类似于代码注释")]),s._v("\nLABEL maintainer"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("“yc_uuu@"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("163")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v('com"\n\n'),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对于复杂的RUN命令，避免无用的分层，多条命令用反斜线换行，合成一条命令！")]),s._v("\nRUN yum update "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" yum install "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y vim \\\n    Python"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dev "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#反斜线换行")]),s._v("\nRUN "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bash "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('c "source $HOME'),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("bashrc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("echo $HOME”\n\nWORKDIR "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#相当于linux的cd命令，改变目录，尽量使用绝对路径！！！不要用RUN cd")]),s._v("\nWORKDIR "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("test "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果没有就自动创建")]),s._v("\nWORKDIR demo "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#再进入demo文件夹")]),s._v("\nRUN pwd     "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#打印结果应该是/test/demo")]),s._v("\n\nADD "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" COPY \nADD hello "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#把本地文件添加到镜像中，吧本地的hello可执行文件拷贝到镜像的/目录")]),s._v("\nADD test"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("tar"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gz "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加到根目录并解压")]),s._v("\n\nWORKDIR "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("root\nADD hello test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#进入/root/ 添加hello可执行命令到test目录下，也就是/root/test/hello 一个绝对路径")]),s._v("\nCOPY hello test"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#等同于上述ADD效果")]),s._v("\n\nADD与COPY\n   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" 优先使用COPY命令\n    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ADD除了COPY功能还有解压功能\n添加远程文件"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("目录使用curl或wget\n\nENV "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#环境变量，尽可能使用ENV增加可维护性")]),s._v("\nENV MYSQL_VERSION "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置一个mysql常量")]),s._v("\nRUN yum install "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y mysql"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("“$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("MYSQL_VERSION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("” \n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("\n\nVOLUME "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" EXPOSE \n存储和网络\n\nRUN "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" CMD "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("and")]),s._v(" ENTRYPOINT\nRUN：执行命令并创建新的Image Layer\nCMD：设置容器启动后默认执行的命令和参数\nENTRYPOINT：设置容器启动时运行的命令\n\nShell格式和Exec格式\nRUN yum install "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y vim\nCMD echo ”hello docker”\nENTRYPOINT echo “hello docker”\n\nExec格式\nRUN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“apt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("get”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("”install”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("”"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("”vim”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nCMD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("echo”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("”hello docker”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nENTRYPOINT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("echo”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("”hello docker”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n\n通过shell格式去运行命令，会读取$name指令，而"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exec")]),s._v("格式是仅仅的执行一个命令，而不是shell指令\ncat Dockerfile\n    FROM centos\n    ENV name Docker\n    ENTRYPOINT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("echo”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("”hello $name”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#这个仅仅是执行echo命令，读取不了shell变量")]),s._v("\n    ENTRYPOINT  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bash”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("”"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("c”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('”echo hello $name"'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nCMD\n容器启动时默认执行的命令\n如果docker run指定了其他命令"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("docker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("it "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("image"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("bash "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("，CMD命令被忽略\n如果定义多个CMD，只有最后一个执行\n\nENTRYPOINT\n让容器以应用程序或服务形式运行\n不会被忽略，一定会执行\n最佳实践：写一个shell脚本作为entrypoint\nCOPY docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("entrypoint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("usr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("local"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("bin")]),s._v("\nENTRYPOINT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("entrypoint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("sh"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nEXPOSE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27017")]),s._v("\nCMD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("“mongod”"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master home"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# more Dockerfile")]),s._v("\nFROm centos\nENV name Docker\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#CMD ["/bin/bash","-c","echo hello $name"]')]),s._v("\nENTRYPOINT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/bash"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-c"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v('"echo hello $name”'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br")])])]),s._v(" "),t("li",[t("h5",{attrs:{id:"dockerfile构建一个flask-web-app"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile构建一个flask-web-app"}},[s._v("#")]),s._v(" dockerfile构建一个flask web app")])])]),s._v(" "),t("ol",[t("li",[t("p",[s._v("编写flask代码文件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("s21flask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py \n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#coding:utf8")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" flask "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Flask\n\tapp"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Flask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__name__"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("route")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("hello")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello docker"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" __name__"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"__main__"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n\t\tapp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("host"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.0.0.0'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("准备Dockerfile (名字必须叫做 Dockerfile)")]),s._v(" "),t("ul",[t("li",[s._v("touch  Dockerfile  ,写入如下内容")])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM_32_137_centos s21docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat Dockerfile ")]),s._v("\n\tFROM centos\n\tCOPY CentOS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Base"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\tCOPY epel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("yum"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repos"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("d"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\tRUN yum clean "),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("all")]),s._v("\n\tRUN yum install python"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("setuptools "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y\n\tRUN easy_install flask\n\tCOPY s21flask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("\n\tWORKDIR "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt\n\tEXPOSE "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n\tCMD "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s21flask.py"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("ul",[t("li",[t("p",[s._v("在Dockerfile同级目录,准备好其他环境文件,代码文件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM_32_137_centos s21docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nCentOS"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Base"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repo  Dockerfile  epel"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("repo  s21flask"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])])])]),s._v(" "),t("li",[t("p",[s._v("构建docker镜像")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("docker build "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t yuchao163"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("s21"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("flask"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("docker "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n\tdocker build  编译Dockerfile  \n\t"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("t  给镜像加上名字  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("镜像名字"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("以仓库地址开头"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("则可以推送到仓库中管理\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("    找到当前的Dockefile文件 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("构建完毕之后,查看镜像文件")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("docker images  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("运行这个flask镜像文件,生成容器实例,代码就跑在容器中了")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("docker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("  指定你要运行的镜像"),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("id")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("名字\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])])])]),s._v(" "),t("h3",{attrs:{id:"_4-6-仓库管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-仓库管理"}},[s._v("#")]),s._v(" 4.6 仓库管理")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("推送本地镜像到dockerhub 共有仓库(私密代码不安全)")]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.")]),s._v("登录docker账户\ndocker login\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.")]),s._v("修改docker镜像文件名字"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("以docker hub账号开头 \ndocker tag docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("io"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("hello"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("world   yuchao163"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("s21"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hello\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("推送镜像到dockerhub仓库中"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("注意这个是公共仓库"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndocker push yuchao163"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("s21"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hello \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("私有docker仓库搭建(保证镜像安全)")])])]),s._v(" "),t("div",{staticClass:"language-python line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[s._v("修改docker的配置文件"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  \ncat "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daemon"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("内容如下\n\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("                                                                                                      \n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry-mirrors"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://f1361db2.m.daocloud.io"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"insecure-registries"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.182.130:5000"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.")]),s._v("修改docker的启动文件"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("加载第二步"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("修改的配置文件\n\nvim "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("systemd"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("system"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("service  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#找到如下的[Service]  代码块,添加参数")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nEnvironmentFile"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("docker"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("daemon"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("json  \n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.")]),s._v("修改了docker配置文件，重新加载docker\nsystemctl daemon"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("reload")]),s._v("\n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.")]),s._v("重启docker服务 \n\nsystemctl restart docker\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.")]),s._v("由于重启了docker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("需要重新运行私有仓库的容器进程\n\ndocker run "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("privileged"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("d "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("opt"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("data"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("registry"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("var"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("lib"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("registry registry\n\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("privileged"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true  docker容器的安全机制：设置特权级运行的容器\n\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1042")]),s._v("  docker pull "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".182")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".130")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("s21"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hello\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1043")]),s._v("  docker run "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".182")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v(".130")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("s21"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("hello\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("h2",{attrs:{id:"_5-推送镜像至dockerhub"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-推送镜像至dockerhub"}},[s._v("#")]),s._v(" 5. 推送镜像至dockerhub")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("创建dockerhub账号:"),t("code",[s._v("bigox")])])]),s._v(" "),t("li",[t("p",[s._v("修改镜像之后保存镜像: "),t("code",[s._v("docker commit b573392cad1a mysql:5.7")])])]),s._v(" "),t("li",[t("p",[s._v("修改镜像标签: "),t("code",[s._v("docker tag mysql:5.7 bigox/mysql:5.7")])])]),s._v(" "),t("li",[t("p",[s._v("登录docker: "),t("code",[s._v("docker login")])])]),s._v(" "),t("li",[t("p",[s._v("推送镜像: "),t("code",[s._v("docker push bigox/mysql:5.7")])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);