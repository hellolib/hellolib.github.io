(window.webpackJsonp=window.webpackJsonp||[]).push([[129],{450:function(s,a,e){"use strict";e.r(a);var n=e(3),t=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"djangoä¸­ä½¿ç”¨celery"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#djangoä¸­ä½¿ç”¨celery"}},[s._v("#")]),s._v(" Djangoä¸­ä½¿ç”¨Celery")]),s._v(" "),a("h2",{attrs:{id:"_1-å‰æˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-å‰æˆ"}},[s._v("#")]),s._v(" 1.å‰æˆ")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Celeryæ˜¯ä¸€ä¸ªåŸºäºpythonå¼€å‘çš„åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—ï¼ŒDjangoçš„è¯·æ±‚å¤„ç†è¿‡ç¨‹éƒ½æ˜¯åŒæ­¥çš„æ— æ³•å®ç°å¼‚æ­¥ä»»åŠ¡ï¼Œè‹¥è¦å®ç°å¼‚æ­¥ä»»åŠ¡å¤„ç†éœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼ï¼ˆå‰ç«¯çš„ä¸€èˆ¬è§£å†³æ–¹æ¡ˆæ˜¯ajaxæ“ä½œï¼‰ï¼Œè€Œåå°Celeryå°±æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚å€˜è‹¥ä¸€ä¸ªç”¨æˆ·åœ¨æ‰§è¡ŒæŸäº›æ“ä½œéœ€è¦ç­‰å¾…å¾ˆä¹…æ‰è¿”å›ï¼Œè¿™å¤§å¤§é™ä½äº†ç½‘ç«™çš„ååé‡ã€‚")])]),s._v(" "),a("li",[a("p",[s._v("Djangoçš„è¯·æ±‚å¤„ç†å¤§è‡´æµç¨‹:")]),s._v(" "),a("ul",[a("li",[s._v("è¯·æ±‚è¿‡ç¨‹ç®€å•è¯´æ˜ï¼šæµè§ˆå™¨å‘èµ·è¯·æ±‚--\x3eè¯·æ±‚å¤„ç†--\x3eè¯·æ±‚ç»è¿‡ä¸­é—´ä»¶--\x3eè·¯ç”±æ˜ å°„--\x3eè§†å›¾å¤„ç†ä¸šåŠ¡é€»è¾‘--\x3eå“åº”è¯·æ±‚(templateæˆ–response)")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/hellolib/pictures/main/Typora/pic-00-gitee/1075473-20180823140036415-321071592.png",alt:"1075473-20180823140036415-321071592"}})])])]),s._v(" "),a("h2",{attrs:{id:"_2-é…ç½®ä½¿ç”¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-é…ç½®ä½¿ç”¨"}},[s._v("#")]),s._v(" 2.é…ç½®ä½¿ç”¨")]),s._v(" "),a("p",[s._v("celeryå¾ˆå®¹æ˜“é›†æˆåˆ°Djangoæ¡†æ¶ä¸­ï¼Œå½“ç„¶å¦‚æœæƒ³è¦å®ç°å®šæ—¶ä»»åŠ¡çš„è¯è¿˜éœ€è¦å®‰è£…django-celery-betaæ’ä»¶ï¼Œåé¢ä¼šè¯´æ˜ã€‚éœ€è¦æ³¨æ„çš„æ˜¯Celery4.0åªæ”¯æŒDjangoç‰ˆæœ¬>=1.8çš„ï¼Œå¦‚æœæ˜¯å°äº1.8ç‰ˆæœ¬éœ€è¦ä½¿ç”¨Celery3.1ã€‚")]),s._v(" "),a("h3",{attrs:{id:"é…ç½®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é…ç½®"}},[s._v("#")]),s._v(" é…ç½®")]),s._v(" "),a("p",[s._v("æ–°å»ºç«‹é¡¹ç›®taskproj,ç›®å½•ç»“æ„ï¼ˆæ¯ä¸ªappä¸‹å¤šäº†ä¸ªtasksæ–‡ä»¶ï¼Œç”¨äºå®šä¹‰ä»»åŠ¡ï¼‰ï¼š")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("taskproj\nâ”œâ”€â”€ app01\nâ”‚   â”œâ”€â”€ __init__.py\nâ”‚   â”œâ”€â”€ apps.py\nâ”‚   â”œâ”€â”€ migrations\nâ”‚   â”‚   â””â”€â”€ __init__.py\nâ”‚   â”œâ”€â”€ models.py\nâ”‚   â”œâ”€â”€ tasks.py\nâ”‚   â””â”€â”€ views.py\nâ”œâ”€â”€ manage.py\nâ”œâ”€â”€ taskproj\nâ”‚   â”œâ”€â”€ __init__.py\nâ”‚   â”œâ”€â”€ settings.py\nâ”‚   â”œâ”€â”€ urls.py\nâ”‚   â””â”€â”€ wsgi.py\nâ””â”€â”€ templates\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("åœ¨é¡¹ç›®ç›®å½•taskproj/taskproj/ç›®å½•ä¸‹æ–°å»ºcelery.py:")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#!/usr/bin/env python3\n# -*- coding:utf-8 -*-\n# Author:wd\nfrom __future__ import absolute_import, unicode_literals\nimport os\nfrom celery import Celery\n\n\nos.environ.setdefault('DJANGO_SETTINGS_MODULE', 'taskproj.settings')  # è®¾ç½®djangoç¯å¢ƒ\n\napp = Celery('taskproj')\n\napp.config_from_object('django.conf:settings', namespace='CELERY') #  ä½¿ç”¨CELERY_ ä½œä¸ºå‰ç¼€ï¼Œåœ¨settingsä¸­å†™é…ç½®\n\napp.autodiscover_tasks()  # å‘ç°ä»»åŠ¡æ–‡ä»¶æ¯ä¸ªappä¸‹çš„task.py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("taskproj/taskproj/"),a("strong",[s._v("init")]),s._v(".pyï¼š")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from __future__ import absolute_import, unicode_literals\nfrom .celery import app as celery_app\n__all__ = ['celery_app']\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("taskproj/taskproj/settings.py")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("CELERY_BROKER_URL = 'redis://10.1.210.69:6379/0' # Brokeré…ç½®ï¼Œä½¿ç”¨Redisä½œä¸ºæ¶ˆæ¯ä¸­é—´ä»¶\n\nCELERY_RESULT_BACKEND = 'redis://10.1.210.69:6379/0' # BACKENDé…ç½®ï¼Œè¿™é‡Œä½¿ç”¨redis\n\nCELERY_RESULT_SERIALIZER = 'json' # ç»“æœåºåˆ—åŒ–æ–¹æ¡ˆ\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("è¿›å…¥é¡¹ç›®çš„taskprojç›®å½•å¯åŠ¨workerï¼š")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("celery worker -A taskproj -l debug\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"å®šä¹‰ä¸è§¦å‘ä»»åŠ¡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®šä¹‰ä¸è§¦å‘ä»»åŠ¡"}},[s._v("#")]),s._v(" å®šä¹‰ä¸è§¦å‘ä»»åŠ¡")]),s._v(" "),a("p",[s._v("ä»»åŠ¡å®šä¹‰åœ¨æ¯ä¸ªtasksæ–‡ä»¶ä¸­ï¼Œapp01ï¼tasks.pyï¼š")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from __future__ import absolute_import, unicode_literals\nfrom celery import shared_task\n\n\n@shared_task\ndef add(x, y):\n    return x + y\n\n\n@shared_task\ndef mul(x, y):\n    return x * y\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("è§†å›¾ä¸­è§¦å‘ä»»åŠ¡")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from django.http import JsonResponse\nfrom app01 import tasks\n\n# Create your views here.\n\ndef index(request,*args,**kwargs):\n    res=tasks.add.delay(1,3)\n    #ä»»åŠ¡é€»è¾‘\n    return JsonResponse({'status':'successful','task_id':res.task_id})\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("è®¿é—®http://127.0.0.1:8000/index")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2018.cnblogs.com/blog/1075473/201808/1075473-20180823175922694-2037330814.png",alt:"img"}})]),s._v(" "),a("p",[s._v("è‹¥æƒ³è·å–ä»»åŠ¡ç»“æœï¼Œå¯ä»¥é€šè¿‡task_idä½¿ç”¨AsyncResultè·å–ç»“æœ,è¿˜å¯ä»¥ç›´æ¥é€šè¿‡backendè·å–ï¼š")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2018.cnblogs.com/blog/1075473/201808/1075473-20180824100626480-211214086.png",alt:"img"}})]),s._v(" "),a("h3",{attrs:{id:"æ‰©å±•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ‰©å±•"}},[s._v("#")]),s._v(" æ‰©å±•")]),s._v(" "),a("p",[s._v("é™¤äº†redisã€rabbitmqèƒ½åšç»“æœå­˜å‚¨å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨Djangoçš„ormä½œä¸ºç»“æœå­˜å‚¨ï¼Œå½“ç„¶éœ€è¦å®‰è£…ä¾èµ–æ’ä»¶ï¼Œè¿™æ ·çš„å¥½å¤„åœ¨äºæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡djangoçš„æ•°æ®æŸ¥çœ‹åˆ°ä»»åŠ¡çŠ¶æ€ï¼ŒåŒæ—¶ä¸ºå¯ä»¥åˆ¶å®šæ›´å¤šçš„æ“ä½œï¼Œä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨ormä½œä¸ºç»“æœå­˜å‚¨ã€‚")]),s._v(" "),a("p",[s._v("1.å®‰è£…")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pip install django-celery-results\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("2.é…ç½®settings.pyï¼Œæ³¨å†Œapp")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("INSTALLED_APPS = (\n    ...,\n    'django_celery_results',\n)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("4.ä¿®æ”¹backendé…ç½®ï¼Œå°†redisæ”¹ä¸ºdjango-db")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("#CELERY_RESULT_BACKEND = 'redis://10.1.210.69:6379/0' # BACKENDé…ç½®ï¼Œè¿™é‡Œä½¿ç”¨redis\n\nCELERY_RESULT_BACKEND = 'django-db'  #ä½¿ç”¨django orm ä½œä¸ºç»“æœå­˜å‚¨\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("5.ä¿®æ”¹æ•°æ®åº“")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("python3 manage.py migrate django_celery_results\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æ­¤æ—¶ä¼šçœ‹åˆ°æ•°æ®åº“ä¼šå¤šåˆ›å»ºï¼š")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2018.cnblogs.com/blog/1075473/201808/1075473-20180824101945385-924791653.png",alt:"img"}}),s._v(" å½“ç„¶ä½ æœ‰æ—¶å€™éœ€è¦å¯¹taskè¡¨è¿›è¡Œæ“ä½œï¼Œä»¥ä¸‹æºç çš„è¡¨ç»“æ„å®šä¹‰ï¼š")]),s._v(" "),a("p",[s._v("["),a("img",{attrs:{src:"https://common.cnblogs.com/images/copycode.gif",alt:"å¤åˆ¶ä»£ç "}}),s._v("](javascript:void(0)ğŸ˜‰")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("class TaskResult(models.Model):\n    \"\"\"Task result/status.\"\"\"\n\n    task_id = models.CharField(_('task id'), max_length=255, unique=True)\n    task_name = models.CharField(_('task name'), null=True, max_length=255)\n    task_args = models.TextField(_('task arguments'), null=True)\n    task_kwargs = models.TextField(_('task kwargs'), null=True)\n    status = models.CharField(_('state'), max_length=50,\n                              default=states.PENDING,\n                              choices=TASK_STATE_CHOICES\n                              )\n    content_type = models.CharField(_('content type'), max_length=128)\n    content_encoding = models.CharField(_('content encoding'), max_length=64)\n    result = models.TextField(null=True, default=None, editable=False)\n    date_done = models.DateTimeField(_('done at'), auto_now=True)\n    traceback = models.TextField(_('traceback'), blank=True, null=True)\n    hidden = models.BooleanField(editable=False, default=False, db_index=True)\n    meta = models.TextField(null=True, default=None, editable=False)\n\n    objects = managers.TaskResultManager()\n\n    class Meta:\n        \"\"\"Table information.\"\"\"\n\n        ordering = ['-date_done']\n\n        verbose_name = _('task result')\n        verbose_name_plural = _('task results')\n\n    def as_dict(self):\n        return {\n            'task_id': self.task_id,\n            'task_name': self.task_name,\n            'task_args': self.task_args,\n            'task_kwargs': self.task_kwargs,\n            'status': self.status,\n            'result': self.result,\n            'date_done': self.date_done,\n            'traceback': self.traceback,\n            'meta': self.meta,\n        }\n\n    def __str__(self):\n        return '<Task: {0.task_id} ({0.status})>'.format(self)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br")])]),a("h2",{attrs:{id:"_3-djangoä¸­ä½¿ç”¨å®šæ—¶ä»»åŠ¡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-djangoä¸­ä½¿ç”¨å®šæ—¶ä»»åŠ¡"}},[s._v("#")]),s._v(" 3.Djangoä¸­ä½¿ç”¨å®šæ—¶ä»»åŠ¡")]),s._v(" "),a("p",[s._v("å¦‚æœæƒ³è¦åœ¨djangoä¸­ä½¿ç”¨å®šæ—¶ä»»åŠ¡åŠŸèƒ½åŒæ ·æ˜¯é beatå®Œæˆä»»åŠ¡å‘é€åŠŸèƒ½ï¼Œå½“åœ¨Djangoä¸­ä½¿ç”¨å®šæ—¶ä»»åŠ¡æ—¶ï¼Œéœ€è¦å®‰è£…django-celery-beatæ’ä»¶ã€‚ä»¥ä¸‹å°†ä»‹ç»ä½¿ç”¨è¿‡ç¨‹ã€‚")]),s._v(" "),a("h3",{attrs:{id:"å®‰è£…é…ç½®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®‰è£…é…ç½®"}},[s._v("#")]),s._v(" å®‰è£…é…ç½®")]),s._v(" "),a("p",[s._v("1.beatæ’ä»¶å®‰è£…")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pip3 install django-celery-beat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("2.æ³¨å†ŒAPP")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("INSTALLED_APPS = [\n    ....   \n    'django_celery_beat',\n]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("3.æ•°æ®åº“å˜æ›´")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("python3 manage.py migrate django_celery_beat\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("4.åˆ†åˆ«å¯åŠ¨wokerå’Œbeta")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("celery -A proj beat -l info --scheduler django_celery_beat.schedulers:DatabaseScheduler  #å¯åŠ¨beta è°ƒåº¦å™¨ä½¿ç”¨æ•°æ®åº“\n\ncelery worker -A taskproj -l info #å¯åŠ¨woker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("5.é…ç½®admin")]),s._v(" "),a("p",[s._v("urls.py")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("# urls.py\nfrom django.conf.urls import url\nfrom django.contrib import admin\n \nurlpatterns = [\n    url(r'^admin/', admin.site.urls),\n]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("6.åˆ›å»ºç”¨æˆ·")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("python3 manage.py createsuperuser \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("7.ç™»å½•adminè¿›è¡Œç®¡ç†ï¼ˆåœ°å€http://127.0.0.1:8000/adminï¼‰å¹¶ä¸”è¿˜å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸Šæ¬¡ä½¿ç”¨ormä½œä¸ºç»“æœå­˜å‚¨çš„è¡¨ã€‚")]),s._v(" "),a("p",[s._v("http://127.0.0.1:8000/admin/login/?next=/admin/")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2018.cnblogs.com/blog/1075473/201808/1075473-20180824140802430-1813363210.png",alt:"img"}})]),s._v(" "),a("p",[s._v("ä½¿ç”¨ç¤ºä¾‹ï¼š")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2018.cnblogs.com/blog/1075473/201808/1075473-20180824142214576-1072914422.png",alt:"img"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2018.cnblogs.com/blog/1075473/201808/1075473-20180824142306542-76662934.png",alt:"img"}})]),s._v(" "),a("p",[s._v("æŸ¥çœ‹ç»“æœï¼š")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2018.cnblogs.com/blog/1075473/201808/1075473-20180824142457980-2047538109.png",alt:"img"}})]),s._v(" "),a("h3",{attrs:{id:"äºŒæ¬¡å¼€å‘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#äºŒæ¬¡å¼€å‘"}},[s._v("#")]),s._v(" äºŒæ¬¡å¼€å‘")]),s._v(" "),a("p",[s._v("django-celery-beatæ’ä»¶æœ¬è´¨ä¸Šæ˜¯å¯¹æ•°æ®åº“è¡¨å˜åŒ–æ£€æŸ¥ï¼Œä¸€æ—¦æœ‰æ•°æ®åº“è¡¨æ”¹å˜ï¼Œè°ƒåº¦å™¨é‡æ–°è¯»å–ä»»åŠ¡è¿›è¡Œè°ƒåº¦ï¼Œæ‰€ä»¥å¦‚æœæƒ³è‡ªå·±å®šåˆ¶çš„ä»»åŠ¡é¡µé¢ï¼Œåªéœ€è¦æ“ä½œbeatæ’ä»¶çš„å››å¼ è¡¨å°±å¯ä»¥äº†ã€‚å½“ç„¶ä½ è¿˜å¯ä»¥è‡ªå·±å®šä¹‰è°ƒåº¦å™¨ï¼Œdjango-celery-beatæ’ä»¶å·²ç»å†…ç½®äº†modelï¼Œåªéœ€è¦è¿›è¡Œå¯¼å…¥ä¾¿å¯è¿›è¡Œormæ“ä½œï¼Œä»¥ä¸‹æˆ‘ç”¨django reset apiè¿›è¡Œç¤ºä¾‹ï¼š")]),s._v(" "),a("p",[s._v("settings.py")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("INSTALLED_APPS = [\n    'django.contrib.admin',\n    'django.contrib.auth',\n    'django.contrib.contenttypes',\n    'django.contrib.sessions',\n    'django.contrib.messages',\n    'django.contrib.staticfiles',\n    'app01.apps.App01Config',\n    'django_celery_results',\n    'django_celery_beat',\n    'rest_framework',\n]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("urls.py")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("urlpatterns = [\n    url(r'^admin/', admin.site.urls),\n    url(r'^index$', views.index),\n    url(r'^res$', views.get_res),\n    url(r'^tasks$', views.TaskView.as_view({'get':'list'})),\n]\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("views.py")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("from django_celery_beat.models import PeriodicTask  #å€’å…¥æ’ä»¶model\nfrom rest_framework import serializers\nfrom rest_framework import pagination\nfrom rest_framework.viewsets import ModelViewSet\nclass Userserializer(serializers.ModelSerializer):\n    class Meta:\n        model = PeriodicTask\n        fields = '__all__'\n\nclass Mypagination(pagination.PageNumberPagination):\n    \"\"\"è‡ªå®šä¹‰åˆ†é¡µ\"\"\"\n    page_size=2\n    page_query_param = 'p'\n    page_size_query_param='size'\n    max_page_size=4\n\nclass TaskView(ModelViewSet):\n    queryset = PeriodicTask.objects.all()\n    serializer_class = Userserializer\n    permission_classes = []\n    pagination_class = Mypagination\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("è®¿é—®http://127.0.0.1:8000/taskså¦‚ä¸‹ï¼š")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://images2018.cnblogs.com/blog/1075473/201808/1075473-20180824153332274-1150335891.png",alt:"img"}})])])}),[],!1,null,null,null);a.default=t.exports}}]);