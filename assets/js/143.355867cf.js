(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{465:function(s,a,t){"use strict";t.r(a);var n=t(3),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"django信号系统"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#django信号系统"}},[s._v("#")]),s._v(" Django信号系统")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("django自带一套信号发射系统来帮助我们在框架的不同位置传递信息．也就是说，当某一事件发生时，信号系统可以允许一个或多个发送者（senders）将通知或信号（signals）推送给一组接受者（receivers）.")])]),s._v(" "),a("li",[a("p",[s._v("信号系统包含以下要素：")]),s._v(" "),a("ol",[a("li",[s._v("发送者（senders）－谁发送了信号")]),s._v(" "),a("li",[s._v("信号（signals）－发送的信号本身")]),s._v(" "),a("li",[s._v("接收者（receivers）－信号是发给谁的")])])])]),s._v(" "),a("h2",{attrs:{id:"django中内置的signal"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#django中内置的signal"}},[s._v("#")]),s._v(" Django中内置的signal")]),s._v(" "),a("h3",{attrs:{id:"_1-model-signal"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-model-signal"}},[s._v("#")]),s._v(" 1. model signal")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#django.db.models.signals.pre_save")]),s._v("\npre_init                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Django中的model对象执行其构造方法前,自动触发")]),s._v("\npost_init                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Django中的model对象执行其构造方法后,自动触发")]),s._v("\npre_save                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Django中的model对象保存前,自动触发")]),s._v("\npost_save                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Django中的model对象保存后,自动触发")]),s._v("\npre_delete                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Django中的model对象删除前,自动触发")]),s._v("\npost_delete                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Django中的model对象删除后,自动触发")]),s._v("\nm2m_changed                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Django中的model对象使用m2m字段操作数据库的第三张表(add,remove,clear,update),自动触发")]),s._v("\nclass_prepared                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 程序启动时,检测到已注册的model类,对于每一个类,自动触发")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"_2-managemeng-signals"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-managemeng-signals"}},[s._v("#")]),s._v(" 2.Managemeng_signals")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("pre_migrate                     # 执行migrate命令前,自动触发\npost_migrate                    # 执行migrate命令后,自动触发 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_3-request-response-signals"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-request-response-signals"}},[s._v("#")]),s._v(" 3.Request/response_signals")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("request_started                 # 请求到来前,自动触发\nrequest_finished                # 请求结束后,自动触发\ngot_request_exception           # 请求异常时,自动触发\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_4-test-signals"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-test-signals"}},[s._v("#")]),s._v(" 4.Test_signals")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("setting_changed                 # 配置文件改变时,自动触发\ntemplate_rendered               # 模板执行渲染操作时,自动触发\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_5-datebase-wrapperd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-datebase-wrapperd"}},[s._v("#")]),s._v(" 5.Datebase_Wrapperd")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("connection_created              # 创建数据库连接时,自动触发\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"一、监听信号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、监听信号"}},[s._v("#")]),s._v(" 一、监听信号")]),s._v(" "),a("p",[s._v("要接收信号，请使用"),a("code",[s._v("Signal.connect()")]),s._v("方法注册一个接收器。当信号发送后，会调用这个接收器。")]),s._v(" "),a("p",[s._v("方法原型：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("Signal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("receiver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sender"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" weak"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("True")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dispatch_uid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("参数：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("receiver ：当前信号连接的回调函数，也就是处理信号的函数。 \nsender ：指定从哪个发送方接收信号。 \nweak ： 是否弱引用\ndispatch_uid ：信号接收器的唯一标识符，以防信号多次发送。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("下面以如何接收每次HTTP请求结束后发送的信号为例，连接到Django内置的"),a("code",[s._v("request_finished")]),s._v("信号。")]),s._v(" "),a("h3",{attrs:{id:"_1-编写接收器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-编写接收器"}},[s._v("#")]),s._v(" 1. 编写接收器")]),s._v(" "),a("p",[s._v("接收器其实就是一个Python函数或者方法：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("my_callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sender"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Request finished!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("请注意，所有的接收器都必须接收一个sender参数和一个"),a("code",[s._v("**kwargs")]),s._v("通配符参数。")]),s._v(" "),a("h3",{attrs:{id:"_2-连接信号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-连接信号"}},[s._v("#")]),s._v(" 2. 连接信号")]),s._v(" "),a("p",[s._v("其实就是监听信号。有两种方法可以连接信号，一种是下面的手动方式：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("signals "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" request_finished\n\nrequest_finished"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("my_callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("另一种是使用receiver()装饰器：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("signals "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" request_finished\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dispatch "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" receiver\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@receiver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request_finished"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("my_callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sender"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Request finished!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"_3-接收特定发送者的信号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-接收特定发送者的信号"}},[s._v("#")]),s._v(" 3. 接收特定发送者的信号")]),s._v(" "),a("p",[s._v("一个信号接收器，通常不需要接收所有的信号，只需要接收特定发送者发来的信号，所以需要在sender参数中，指定发送方。下面的例子，只接收MyModel模型的实例保存前的信号。")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("models"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("signals "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" pre_save   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 另外一个内置的常用信号")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dispatch "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" receiver\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" myapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("models "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" MyModel\n\n\n"),a("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[s._v("@receiver")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pre_save"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sender"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MyModel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("my_handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sender"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("code",[s._v("my_handler")]),s._v("函数只在MyModel实例保存时被调用。")]),s._v(" "),a("h3",{attrs:{id:"_4-防止重复信号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-防止重复信号"}},[s._v("#")]),s._v(" 4. 防止重复信号")]),s._v(" "),a("p",[s._v("为了防止重复信号，可以设置"),a("code",[s._v("dispatch_uid")]),s._v("参数来标识你的接收器，标识符通常是一个字符串，如下所示：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("core"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("signals "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" request_finished\n\nrequest_finished"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("my_callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dispatch_uid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my_unique_identifier"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("最后的结果是，对于每个唯一的"),a("code",[s._v("dispatch_uid")]),s._v("值，你的接收器都只绑定到信号一次。")]),s._v(" "),a("h2",{attrs:{id:"二、自定义信号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、自定义信号"}},[s._v("#")]),s._v(" 二、自定义信号")]),s._v(" "),a("p",[s._v("除了Django为我们提供的内置信号（比如前面列举的那些），很多时候，我们需要自己定义信号。")]),s._v(" "),a("p",[s._v("所有的信号都是"),a("code",[s._v("django.dispatch.Signal")]),s._v("的实例。")]),s._v(" "),a("h3",{attrs:{id:"_1-创建信号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建信号"}},[s._v("#")]),s._v(" 1. 创建信号")]),s._v(" "),a("ul",[a("li",[s._v('说明：pizza_done是信号名，providing_args=["toppings", "size"]，这个是触发者的时候需要传递的参数')])]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dispath\n\npizza_done"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("django"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("dispath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Signal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("providing_args"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"toppings"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"size"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_2-注册信号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-注册信号"}},[s._v("#")]),s._v(" 2. 注册信号")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("callback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sender"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("**")]),s._v("kwargs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#创建注册信号的函数，这边的注册函数可以写多个")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"callback"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("print")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sender"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("kwargs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  \npizza_done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("connect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("callback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注册信号")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h3",{attrs:{id:"_3-发送信号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-发送信号"}},[s._v("#")]),s._v(" 3. 发送信号")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" 路径 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" pizza_done\npizza_done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("send"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sender"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'zhangqigao'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("toppings"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" size"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("456")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("Django中有两种方法用于发送信号。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Signal.send(sender, **kwargs)")])]),s._v(" "),a("li",[a("p",[s._v("Signal.send_robust（sender，** kwargs）")])])]),s._v(" "),a("p",[s._v("必须提供sender参数（大部分情况下是一个类名），并且可以提供任意数量的其他关键字参数。")]),s._v(" "),a("p",[s._v("例如，这样来发送前面的"),a("code",[s._v("pizza_done")]),s._v("信号：")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("PizzaStore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("object")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("send_pizza")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" toppings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        pizza_done"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("send"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("sender"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("__class__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" toppings"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("toppings"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" size"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("size"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("code",[s._v("send()")]),s._v("和"),a("code",[s._v("send_robust()")]),s._v("返回一个元组对的列表"),a("code",[s._v("[（receiver, response）， ... ]")]),s._v("，表示接收器和响应值二元元组的列表。")]),s._v(" "),a("h2",{attrs:{id:"三、断开信号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、断开信号"}},[s._v("#")]),s._v(" 三、断开信号")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("Signal"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("disconnect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("receiver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sender"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" dispatch_uid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("None")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("code",[s._v("Signal.disconnect()")]),s._v("用来断开信号的接收器，和"),a("code",[s._v("Signal.connect()")]),s._v("中的参数相同。如果接收器成功断开，返回True，否则返回False。")])])}),[],!1,null,null,null);a.default=e.exports}}]);